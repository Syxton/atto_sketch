YUI.add("moodle-atto_sketch-button",function(e,t){var n="atto_sketch",r={ISPERCENT:/\d+%/},i=[{name:"verticalAlign",str:"alignment_top",value:"text-top",margin:"0 0.5em"},{name:"verticalAlign",str:"alignment_middle",value:"middle",margin:"0 0.5em"},{name:"verticalAlign",str:"alignment_bottom",value:"text-bottom",margin:"0 0.5em",isDefault:!0},{name:"float",str:"alignment_left",value:"left",margin:"0 0.5em 0 0"},{name:"float",str:"alignment_right",value:"right",margin:"0 0 0 0.5em"}],s="../lib/editor/atto/plugins/sketch/sketch.html",o="sketchpad",o="sketchpad",u="submit",a="",f={INPUTSUBMIT:"atto_sketch_submit",HEIGHT:"min-height: 400px;height: calc(100% - 40px);",WIDTH:"width: 100%;"},l=null,c='<iframe src="{{isource}}" id="{{iframeID}}" style="{{CSS.HEIGHT}}{{CSS.WIDTH}}" scrolling="auto" frameborder="0"></iframe><div style="text-align:center"><button class="mdl-align {{CSS.INPUTSUBMIT}}" id="{{submitid}}" style="{{selectalign}}">{{get_string "insert" component}}</button></div>';e.namespace("M.atto_sketch").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,initializer:function(){var e="iconone";this.addButton({icon:"ed/"+e,iconComponent:"atto_sketch",buttonName:e,callback:this._displayDialogue,callbackArgs:e,tags:"img",tagMatchRequiresAll:!1})},_getSelectedImageProperties:function(){var e={src:null,alt:null,width:null,height:null,align:"",presentation:!1},t=this.get("host").getSelectedNodes(),n,i,s,o;return t&&(t=t.filter("img")),t&&t.size()?(o=this._removeLegacyAlignment(t.item(0)),this._selectedImage=o,s=o.getAttribute("style"),e.customstyle=s,n=o.getAttribute("width"),n.match(r.ISPERCENT)||(n=parseInt(n,10)),i=o.getAttribute("height"),i.match(r.ISPERCENT)||(i=parseInt(i,10)),n!==0&&(e.width=n),i!==0&&(e.height=i),this._getAlignmentPropeties(o,e),e.src=o.getAttribute("src"),e.alt=o.getAttribute("alt")||"",e.presentation=o.get("role")==="presentation",e):(this._selectedImage=null,!1)},_removeLegacyAlignment:function(t){return t.getStyle("margin")?(i.some(function(n){if(t.getStyle(n.name)!==n.value)return!1;var r=e.Node.create("<div>");return r.setStyle("margin",n.margin),t.getStyle("margin")!==r.getStyle("margin")?!1:(t.addClass(this._getAlignmentClass(n.value)),t.setStyle(n.name,null),t.setStyle("margin",null),!0)},this),t):t},_getAlignmentClass:function(e){return f.ALIGNSETTINGS+"_"+e},_getAlignmentPropeties:function(e,t){var n=!1,r;n=i.some(function(n){var i=this._getAlignmentClass(n.value);return e.hasClass(i)?(t.align=n.value,!0):(n.isDefault&&(r=n.value),!1)},this),!n&&r&&(t.align=r)},_displayDialogue:function(t,r){this._currentSelection=this.get("host").getSelection();var i="95%",u="95%",a=this.getDialogue({headerContent:M.util.get_string("sketchtitle",n),width:i,height:u,focusAfterHide:r}),f,c,h,p,d,v,m;t.preventDefault(),a.after("visibleChange",function(){var e=a.getAttrs();e.visible===!1&&setTimeout(function(){a.reset()},5)}),a.width!==i+"px"&&a.set("width",i+"px"),a.height!==u+"px"&&a.set("height",u+"px"),c=this._getFormContent(r),e.one(".moodle-dialogue-bd").setStyle("min-height","500px"),e.one(".moodle-dialogue-bd").setStyle("height","calc(100% - 55px)");if(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0)e.one(".moodle-dialogue").setStyle("height","0"),e.one(".moodle-dialogue").setStyle("min-height","560px");a.set("bodyContent",c),document.getElementById(o).src=s,a.centerDialogue(),a.show(),this.markUpdated();var g=!1;this._currentSelection!==!1&&(g=this._getSelectedImageProperties()),document.getElementById(o).addEventListener("load",function(){l=document.getElementById(o).contentWindow.LC.init(document.getElementById(o).contentDocument.getElementsByClassName("literally")[0],{imageURLPrefix:"assets/img"});if(g){var e=new Image;e.src=g.src,l.saveShape(document.getElementById(o).contentWindow.LC.createShape("Image",{x:10,y:10,image:e}))}})},_getFormContent:function(t){var r=e.Handlebars.compile(c),i=e.Node.create(r({elementid:this.get("host").get("elementid"),CSS:f,component:n,clickedicon:t,isource:s,iframeID:o,submitid:u,selectalign:a}));return this._form=i,this._form.one("."+f.INPUTSUBMIT).on("click",this._doInsert,this),i},_doInsert:function(e){e.preventDefault();var t=this,n=l.getImage().toDataURL(),r='<img src="'+n+'" />';t.getDialogue({focusAfterHide:null}).hide(),t.editor.focus(),t.get("host").insertContentAtFocusPoint(r),t.markUpdated()}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
