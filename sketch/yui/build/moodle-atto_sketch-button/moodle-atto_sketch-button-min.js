YUI.add("moodle-atto_sketch-button",function(e,t){var n="atto_sketch",r={ISPERCENT:/\d+%/},i="../lib/editor/atto/plugins/sketch/sketch.html",s="sketchpad",o="submit",u={INPUTSUBMIT:"atto_sketch_submit",HGT:"min-height: 400px;height: calc(100% - 40px);",WDT:"width: 100%;"},a='<iframe src="{{isource}}" id="{{iframeID}}" style="{{CSS.HGT}}{{CSS.WDT}}" scrolling="auto" frameborder="0">                </iframe>                <div style="text-align:center">                    <button class="mdl-align {{CSS.INPUTSUBMIT}}" id="{{submitid}}" style="{{selectalign}}">                        {{get_string "insert" component}}                    </button>                </div>',f=null;e.namespace("M.atto_sketch").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){var e="iconone";this.addButton({icon:"ed/"+e,iconComponent:"atto_sketch",buttonName:e,callback:this._displayDialogue,callbackArgs:e,tags:"img",tagMatchRequiresAll:!1})},_getSelectedImageProperties:function(){var e={src:null,alt:null,width:null,height:null},t=this.get("host").getSelectedNodes(),n,i;return t&&(t=t.filter("img")),t&&t.size()?(this._selectedImage=t.item(0),n=this._selectedImage.getAttribute("width"),n.match(r.ISPERCENT)||(n=parseInt(n,10)),i=this._selectedImage.getAttribute("height"),i.match(r.ISPERCENT)||(i=parseInt(i,10)),n!==0&&(e.width=n),i!==0&&(e.height=i),e.src=this._selectedImage.getAttribute("src"),e.alt=this._selectedImage.getAttribute("alt")||"",e):(this._selectedImage=null,!1)},_displayDialogue:function(t,r){var o="95%",u="95%",a,l;l=this.getDialogue({headerContent:M.util.get_string("sketchtitle",n),width:o,height:u,focusAfterHide:r}),t.preventDefault(),l.after("visibleChange",function(){var e=l.getAttrs();e.visible===!1&&setTimeout(function(){l.reset()},5)}),l.width!==o+"px"&&l.set("width",o+"px"),l.height!==u+"px"&&l.set("height",u+"px"),a=this._getFormContent(r),e.one(".moodle-dialogue-bd").setStyle("min-height","500px"),e.one(".moodle-dialogue-bd").setStyle("height","calc(100% - 55px)");if(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0)e.one(".moodle-dialogue").setStyle("height","0"),e.one(".moodle-dialogue").setStyle("min-height","560px");l.set("bodyContent",a),document.getElementById(s).src=i,l.centerDialogue(),l.show(),this.markUpdated();var c=!1;this.get("host").getSelection()!==!1&&(c=this._getSelectedImageProperties()),document.getElementById(s).addEventListener("load",function(){var e=document.getElementById(s).contentDocument.getElementsByClassName("literally")[0];f=document.getElementById(s).contentWindow.LC.init(e,{imageURLPrefix:"assets/img"});if(c){var t=new Image;t.src=c.src;var n=document.getElementById(s).contentWindow.LC.createShape("Image",{x:10,y:10,image:t});f.saveShape(n)}})},_getFormContent:function(t){var r=e.Handlebars.compile(a),f=e.Node.create(r({elementid:this.get("host").get("elementid"),CSS:u,component:n,clickedicon:t,isource:i,iframeID:s,submitid:o}));return this._form=f,this._form.one("."+u.INPUTSUBMIT).on("click",this._doInsert,this),f},_doInsert:function(e){e.preventDefault();var t=this,n=f.getImage().toDataURL(),r='<img src="'+n+'" />';t.getDialogue({focusAfterHide:null}).hide(),t.editor.focus(),t.get("host").insertContentAtFocusPoint(r),t.markUpdated()}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
